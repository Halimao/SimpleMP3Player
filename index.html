<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MP3播放器</title>
    <link rel="icon" href="https://p6-flow-sign.byteimg.com/tos-cn-i-ik7evvg4ik/rc/pc/super_tool/149d45fff4354aebab6dccc0e1ecfc9b.svg?rcl=202511261909332EC2BCC6C580A4EF7174&rk3s=8e244e95&rrcfp=f512b60b&x-expires=1765451404&x-signature=DtYxX9%2FyZZqkOe00xjXsCvS6eTk%3D" type="image/svg+xml">
    <link rel="icon" href="https://p6-flow-sign.byteimg.com/tos-cn-i-ik7evvg4ik/rc/pc/super_tool/149d45fff4354aebab6dccc0e1ecfc9b.svg?rcl=202511261909332EC2BCC6C580A4EF7174&rk3s=8e244e95&rrcfp=f512b60b&x-expires=1765451404&x-signature=DtYxX9%2FyZZqkOe00xjXsCvS6eTk%3D" type="image/png" sizes="32x32">
    <link rel="apple-touch-icon" href="https://p6-flow-sign.byteimg.com/tos-cn-i-ik7evvg4ik/rc/pc/super_tool/149d45fff4354aebab6dccc0e1ecfc9b.svg?rcl=202511261909332EC2BCC6C580A4EF7174&rk3s=8e244e95&rrcfp=f512b60b&x-expires=1765451404&x-signature=DtYxX9%2FyZZqkOe00xjXsCvS6eTk%3D">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/v4-shims.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        dark: '#1F2937',
                        light: '#F9FAFB'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>

    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .backdrop-blur {
                backdrop-filter: blur(8px);
            }
            .gradient-bg {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
            .player-shadow {
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            }
            .button-hover {
                transition: all 0.3s ease;
            }
            .button-hover:hover {
                transform: translateY(-2px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            }
            .speed-button {
                transition: all 0.2s ease;
            }
            .speed-button.active {
                background-color: #3B82F6;
                color: white;
                transform: scale(1.05);
            }
            .volume-button {
                transition: all 0.2s ease;
            }
            .volume-button.active {
                background-color: #3B82F6;
                color: white;
                transform: scale(1.05);
            }
            .list-item {
                transition: all 0.2s ease;
            }
            .list-item:hover {
                background-color: rgba(59, 130, 246, 0.1);
                transform: translateX(4px);
            }
            .list-item.active {
                background-color: rgba(59, 130, 246, 0.2);
                border-left: 4px solid #3B82F6;
            }
            .volume-slider::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                background: #3B82F6;
                cursor: pointer;
                transition: all 0.2s ease;
            }
            .volume-slider::-webkit-slider-thumb:hover {
                transform: scale(1.2);
                box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
            }
        }
    </style>
</head>

<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-md">
        <!-- 播放器主容器 -->
        <div class="bg-white rounded-3xl player-shadow overflow-hidden">
            <!-- 播放器头部 -->
            <div class="gradient-bg p-6 text-white">
                <div class="flex justify-between items-center mb-4">
                    <h1 class="text-2xl font-bold">MP3播放器</h1>
                    <button id="toggleListBtn" class="button-hover bg-white/20 rounded-full p-3">
                        <i class="fa fa-list text-xl"></i>
                    </button>
                </div>
                <div class="text-center">
                    <div class="w-24 h-24 bg-white/30 rounded-full mx-auto mb-4 flex items-center justify-center">
                        <i class="fa fa-music text-4xl"></i>
                    </div>
                    <h2 id="currentTitle" class="text-lg font-semibold mb-1">选择音频文件</h2>
                    <p id="currentArtist" class="text-sm opacity-90">点击列表选择</p>
                </div>
            </div>

            <!-- 播放进度条 -->
            <div class="px-6 py-4">
                <div class="flex justify-between text-sm text-gray-500 mb-2">
                    <span id="currentTime">0:00</span>
                    <span id="totalTime">0:00</span>
                </div>
                <div class="relative">
                    <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div id="progressBar" class="h-full bg-primary rounded-full transition-all duration-100"
                            style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- 播放控制按钮 -->
            <div class="px-8 py-6">
                <div class="flex justify-between items-center">
                    <div class="flex space-x-4">
                        <button id="loopBtn" class="button-hover bg-gray-100 rounded-full p-4">
                            <i class="fa fa-repeat text-gray-600"></i>
                        </button>
                        <button id="prevBtn" class="button-hover bg-gray-100 rounded-full p-4">
                            <i class="fa fa-step-backward text-gray-600"></i>
                        </button>
                    </div>

                    <button id="playPauseBtn" class="button-hover bg-primary text-white rounded-full p-6 scale-110">
                        <i class="fa fa-play text-xl"></i>
                    </button>

                    <div class="flex space-x-4">
                        <button id="nextBtn" class="button-hover bg-gray-100 rounded-full p-4">
                            <i class="fa fa-step-forward text-gray-600"></i>
                        </button>
                        <button id="volumeBtn" class="button-hover bg-gray-100 rounded-full p-4">
                            <i class="fa fa-volume-up text-gray-600"></i>
                        </button>
                        <button id="speedBtn" class="button-hover bg-gray-100 rounded-full p-4">
                            <i class="fa fa-tachometer text-gray-600"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- 音量调节面板 -->
            <div id="volumePanel" class="px-6 py-4 hidden">
                <h3 class="text-sm font-semibold text-gray-600 mb-3">音量控制</h3>
                <div class="flex items-center space-x-4">
                    <button id="muteBtn" class="button-hover bg-gray-100 rounded-lg py-2 px-4 text-sm">
                        <i class="fa fa-volume-up"></i>
                    </button>
                    <div class="flex-1">
                        <input type="range" id="volumeSlider" min="0" max="100" value="80"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer volume-slider">
                    </div>
                    <span id="volumeValue" class="text-sm font-medium">80%</span>
                </div>
                <div class="grid grid-cols-3 gap-2 mt-3">
                    <button class="volume-button bg-gray-100 rounded-lg py-2 text-sm" data-volume="30">低</button>
                    <button class="volume-button bg-gray-100 rounded-lg py-2 text-sm active" data-volume="80">中</button>
                    <button class="volume-button bg-gray-100 rounded-lg py-2 text-sm" data-volume="100">高</button>
                </div>
            </div>

            <!-- 速度调节面板 -->
            <div id="speedPanel" class="px-6 py-4 hidden">
                <h3 class="text-sm font-semibold text-gray-600 mb-3">播放速度</h3>
                <div class="grid grid-cols-4 gap-2">
                    <button class="speed-button bg-gray-100 rounded-lg py-2 text-sm" data-speed="0.5">0.5x</button>
                    <button class="speed-button bg-gray-100 rounded-lg py-2 text-sm" data-speed="0.75">0.75x</button>
                    <button class="speed-button bg-gray-100 rounded-lg py-2 text-sm" data-speed="0.9">0.9x</button>
                    <button class="speed-button bg-gray-100 rounded-lg py-2 text-sm active" data-speed="1">1x</button>
                    <button class="speed-button bg-gray-100 rounded-lg py-2 text-sm" data-speed="1.1">1.1x</button>
                    <button class="speed-button bg-gray-100 rounded-lg py-2 text-sm" data-speed="1.2">1.2x</button>
                    <button class="speed-button bg-gray-100 rounded-lg py-2 text-sm" data-speed="1.5">1.5x</button>
                    <button class="speed-button bg-gray-100 rounded-lg py-2 text-sm" data-speed="2">2x</button>
                </div>
            </div>

            <!-- 播放列表 -->
            <div id="playlistPanel" class="px-6 py-4 hidden max-h-60 overflow-y-auto">
                <h3 class="text-sm font-semibold text-gray-600 mb-3">播放列表</h3>
                <div id="playlist" class="space-y-2">
                    <!-- 播放列表项将通过JS动态生成 -->
                </div>
            </div>
        </div>

        <!-- 底部版权信息 -->
        <div class="text-center mt-6 text-sm text-gray-500">
            <p>MP3播放器 &copy; Halimao</p>
        </div>
    </div>

    <script>
        // 音频文件列表（示例数据）
        const audioFiles = [
            { id: 1, title: '波波的魔法右脚', artist: 'Halimao', url: '波波的魔法右脚.mp3' },
        ];

        // 音频元素
        const audio = new Audio();
        let currentIndex = -1;
        let isPlaying = false;
        let isLooping = false;
        let currentSpeed = 1;
        let currentVolume = 0.8; // 0-1范围
        let isMuted = false;
        let autoSelectIndex = -1; // 用于存储通过URL参数选择的音频索引

        // DOM元素
        const playPauseBtn = document.getElementById('playPauseBtn');
        const loopBtn = document.getElementById('loopBtn');
        const volumeBtn = document.getElementById('volumeBtn');
        const speedBtn = document.getElementById('speedBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const toggleListBtn = document.getElementById('toggleListBtn');
        const volumePanel = document.getElementById('volumePanel');
        const speedPanel = document.getElementById('speedPanel');
        const playlistPanel = document.getElementById('playlistPanel');
        const progressBar = document.getElementById('progressBar');
        const currentTime = document.getElementById('currentTime');
        const totalTime = document.getElementById('totalTime');
        const currentTitle = document.getElementById('currentTitle');
        const currentArtist = document.getElementById('currentArtist');
        const playlist = document.getElementById('playlist');
        const muteBtn = document.getElementById('muteBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeValue = document.getElementById('volumeValue');

        // 初始化播放列表
        function initPlaylist() {
            playlist.innerHTML = '';
            audioFiles.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'list-item p-3 rounded-lg flex justify-between items-center';
                item.innerHTML = `
                    <div>
                        <div class="font-medium">${file.title}</div>
                        <div class="text-xs text-gray-500">${file.artist}</div>
                    </div>
                    <i class="fa fa-music text-gray-400"></i>
                `;
                item.addEventListener('click', () => {
                    playAudio(index);
                });
                item.dataset.index = index;
                playlist.appendChild(item);
            });
        }

        // 播放音频
        function playAudio(index) {
            if (index < 0 || index >= audioFiles.length) return;

            currentIndex = index;
            const file = audioFiles[index];

            // 更新UI
            currentTitle.textContent = file.title;
            currentArtist.textContent = file.artist;

            // 更新播放列表选中状态
            document.querySelectorAll('.list-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.list-item[data-index="${index}"]`).classList.add('active');

            // 设置音频源
            audio.src = file.url;
            audio.playbackRate = currentSpeed;
            audio.loop = isLooping;
            audio.volume = currentVolume;
            audio.muted = isMuted;

            // 播放音频
            audio.play().then(() => {
                isPlaying = true;
                updatePlayPauseButton();
            }).catch(error => {
                console.error('播放失败:', error);
                // 处理自动播放限制错误
                if (error.name === 'NotAllowedError') {
                    alert('请先点击播放按钮开始播放（浏览器限制自动播放）');
                    // 仍然更新UI，让用户知道选择了哪个文件
                    isPlaying = false;
                    updatePlayPauseButton();
                } else {
                    alert('无法播放音频，请检查网络连接');
                }
            });
        }

        // 更新播放/暂停按钮
        function updatePlayPauseButton() {
            const icon = playPauseBtn.querySelector('i');
            if (isPlaying) {
                icon.className = 'fa fa-pause text-xl';
            } else {
                icon.className = 'fa fa-play text-xl';
            }
        }

        // 更新进度条
        function updateProgress() {
            if (audio.duration) {
                const progress = (audio.currentTime / audio.duration) * 100;
                progressBar.style.width = `${progress}%`;

                // 更新时间显示
                currentTime.textContent = formatTime(audio.currentTime);
                totalTime.textContent = formatTime(audio.duration);
            }
        }

        // 格式化时间
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        // 切换循环模式
        function toggleLoop() {
            isLooping = !isLooping;
            audio.loop = isLooping;

            if (isLooping) {
                loopBtn.classList.add('bg-primary', 'text-white');
                loopBtn.classList.remove('bg-gray-100', 'text-gray-600');
            } else {
                loopBtn.classList.remove('bg-primary', 'text-white');
                loopBtn.classList.add('bg-gray-100', 'text-gray-600');
            }
        }

        // 切换音量面板
        function toggleVolumePanel() {
            volumePanel.classList.toggle('hidden');
            // 如果打开音量面板，关闭速度面板
            if (!volumePanel.classList.contains('hidden')) {
                speedPanel.classList.add('hidden');
                playlistPanel.classList.add('hidden');
            }
        }

        // 切换静音
        function toggleMute() {
            isMuted = !isMuted;
            audio.muted = isMuted;

            const icon = muteBtn.querySelector('i');
            const volumeIcon = volumeBtn.querySelector('i');

            if (isMuted) {
                icon.className = 'fa fa-volume-off';
                volumeIcon.className = 'fa fa-volume-off text-gray-600';
                muteBtn.classList.add('bg-red-100', 'text-red-600');
                muteBtn.classList.remove('bg-gray-100');
            } else {
                updateVolumeIcon();
                icon.className = 'fa fa-volume-up';
                muteBtn.classList.remove('bg-red-100', 'text-red-600');
                muteBtn.classList.add('bg-gray-100');
            }
        }

        // 更新音量图标
        function updateVolumeIcon() {
            const volumeIcon = volumeBtn.querySelector('i');
            if (isMuted) {
                volumeIcon.className = 'fa fa-volume-off text-gray-600';
            } else if (currentVolume === 0) {
                volumeIcon.className = 'fa fa-volume-off text-gray-600';
            } else if (currentVolume < 0.5) {
                volumeIcon.className = 'fa fa-volume-down text-gray-600';
            } else {
                volumeIcon.className = 'fa fa-volume-up text-gray-600';
            }
        }

        // 设置音量
        function setVolume(volume) {
            // volume是0-100的百分比
            currentVolume = volume / 100;
            audio.volume = currentVolume;
            isMuted = false;
            audio.muted = false;

            // 更新滑块
            volumeSlider.value = volume;
            volumeValue.textContent = `${volume}%`;

            // 更新按钮状态
            document.querySelectorAll('.volume-button').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.volume) === volume) {
                    btn.classList.add('active');
                }
            });

            // 更新图标
            updateVolumeIcon();
            const icon = muteBtn.querySelector('i');
            icon.className = 'fa fa-volume-up';
            muteBtn.classList.remove('bg-red-100', 'text-red-600');
            muteBtn.classList.add('bg-gray-100');
        }

        // 调节音量滑块
        function adjustVolumeSlider() {
            const volume = parseInt(volumeSlider.value);
            setVolume(volume);
        }

        // 设置播放速度
        function setPlaybackSpeed(speed) {
            currentSpeed = speed;
            audio.playbackRate = speed;

            // 更新速度按钮状态
            document.querySelectorAll('.speed-button').forEach(btn => {
                btn.classList.remove('active');
                if (parseFloat(btn.dataset.speed) === speed) {
                    btn.classList.add('active');
                }
            });

            // 隐藏速度面板
            speedPanel.classList.add('hidden');
        }

        // 从URL参数获取要选择的音频ID
        function getAutoSelectAudioId() {
            const urlParams = new URLSearchParams(window.location.search);
            const aid = urlParams.get('aid');
            return aid ? parseInt(aid) : null;
        }

        // 自动选择指定ID的音频（但不自动播放）
        function autoSelectAudio() {
            const autoSelectId = getAutoSelectAudioId();
            if (autoSelectId) {
                // 在音频列表中查找匹配的ID
                const audioIndex = audioFiles.findIndex(file => file.id === autoSelectId);
                if (audioIndex !== -1) {
                    // 存储要选择的索引，等待用户交互
                    autoSelectIndex = audioIndex;

                    // 更新UI显示选中的音频信息
                    const file = audioFiles[audioIndex];
                    currentTitle.textContent = file.title;
                    currentArtist.textContent = file.artist;

                    // 更新播放列表选中状态
                    document.querySelectorAll('.list-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    document.querySelector(`.list-item[data-index="${audioIndex}"]`).classList.add('active');

                    console.log(`已通过URL参数选择音频: ${file.title}`);
                } else {
                    console.log(`未找到ID为${autoSelectId}的音频文件`);
                }
            }
        }

        // 事件监听
        playPauseBtn.addEventListener('click', () => {
            if (currentIndex === -1) {
                // 检查是否有通过URL参数选择的音频
                if (autoSelectIndex !== -1) {
                    // 使用URL参数选择的音频
                    playAudio(autoSelectIndex);
                } else {
                    // 没有选择音频，默认播放第一个
                    playAudio(0);
                }
            } else {
                if (isPlaying) {
                    audio.pause();
                } else {
                    audio.play();
                }
                isPlaying = !isPlaying;
                updatePlayPauseButton();
            }
        });

        loopBtn.addEventListener('click', toggleLoop);

        volumeBtn.addEventListener('click', toggleVolumePanel);

        speedBtn.addEventListener('click', () => {
            speedPanel.classList.toggle('hidden');
            // 如果打开速度面板，关闭音量面板
            if (!speedPanel.classList.contains('hidden')) {
                volumePanel.classList.add('hidden');
                playlistPanel.classList.add('hidden');
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentIndex > 0) {
                playAudio(currentIndex - 1);
            } else {
                playAudio(audioFiles.length - 1); // 循环到最后一个
            }
        });

        nextBtn.addEventListener('click', () => {
            if (currentIndex < audioFiles.length - 1) {
                playAudio(currentIndex + 1);
            } else {
                playAudio(0); // 循环到第一个
            }
        });

        toggleListBtn.addEventListener('click', () => {
            playlistPanel.classList.toggle('hidden');
            // 如果打开播放列表，关闭其他面板
            if (!playlistPanel.classList.contains('hidden')) {
                volumePanel.classList.add('hidden');
                speedPanel.classList.add('hidden');
            }
        });

        // 静音按钮点击事件
        muteBtn.addEventListener('click', toggleMute);

        // 音量滑块事件
        volumeSlider.addEventListener('input', adjustVolumeSlider);
        volumeSlider.addEventListener('change', adjustVolumeSlider);

        // 音量预设按钮点击事件
        document.querySelectorAll('.volume-button').forEach(btn => {
            btn.addEventListener('click', () => {
                setVolume(parseInt(btn.dataset.volume));
            });
        });

        // 速度按钮点击事件
        document.querySelectorAll('.speed-button').forEach(btn => {
            btn.addEventListener('click', () => {
                setPlaybackSpeed(parseFloat(btn.dataset.speed));
            });
        });

        // 音频事件监听
        audio.addEventListener('timeupdate', updateProgress);
        audio.addEventListener('loadedmetadata', updateProgress);
        audio.addEventListener('ended', () => {
            if (isLooping) {
                audio.play();
            } else {
                isPlaying = false;
                updatePlayPauseButton();
                // 自动播放下一个
                if (currentIndex < audioFiles.length - 1) {
                    setTimeout(() => {
                        playAudio(currentIndex + 1);
                    }, 500);
                }
            }
        });

        // 进度条点击事件
        progressBar.parentElement.addEventListener('click', (e) => {
            const rect = progressBar.parentElement.getBoundingClientRect();
            const clickX = e.clientX - rect.left;
            const width = rect.width;
            const duration = audio.duration;
            audio.currentTime = (clickX / width) * duration;
        });

        // 初始化
        initPlaylist();
        setPlaybackSpeed(1); // 默认1倍速
        setVolume(80); // 默认80%音量

        // 检查是否需要自动选择音频
        document.addEventListener('DOMContentLoaded', () => {
            autoSelectAudio();
        });
    </script>
</body>

</html>
